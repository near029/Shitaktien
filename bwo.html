<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meine Spotify Auswertung</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.bundle.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --spotify-green: #1DB954;
    }
    body {
      background-color: #121212;
      color: var(--spotify-green);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 2rem;
    }
    h1, h2, h3 {
      color: var(--spotify-green);
    }
    .card {
      background-color: #181818;
      border: none;
      border-radius: 1rem;
      transition: transform 0.3s ease;
    }
    .card p, .card li {
      color: var(--spotify-green);
    }
    .card:hover {
      transform: scale(1.02);
    }
    a.btn-back {
      margin-bottom: 2rem;
    }
    .fade-in {
      animation: fadeIn 1s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    ul li::before {
      content: "üéß ";
    }
    .icon {
      font-size: 1.5rem;
      color: var(--spotify-green);
      margin-right: 0.5rem;
    }
    a {
      color: var(--spotify-green);
    }
    a:hover {
      color: #1ed760;
    }
    /* Dropdown Checkbox Style */
    .dropdown-menu {
      background-color: #181818;
      border: none;
      padding: 1rem 1.5rem;
      min-width: 220px;
    }
    .dropdown-item {
      cursor: pointer;
    }
    .form-check-input {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container fade-in">
    <!-- Obere Auswahl Dropdown -->
    <div class="d-flex justify-content-start mb-4 gap-3 flex-wrap">
      <div class="dropdown">
        <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          Auswahl
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item text-success" href="#">üéµ Lieblingsk√ºnstler</a></li>
          <li><a class="dropdown-item text-success" href="#">üìà Genre-Trends</a></li>
          <li><a class="dropdown-item text-success" href="#">‚è± H√∂rgewohnheiten</a></li>
          <li><a class="dropdown-item text-success" href="#">üìÇ Datenexport</a></li>
        </ul>
      </div>

      <!-- Genre Multiselect Dropdown -->
      <div class="dropdown">
        <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          Genres ausw√§hlen
        </button>
        <ul class="dropdown-menu">
          <li class="form-check">
            <input class="form-check-input" type="checkbox" value="pop" id="genrePop" checked />
            <label class="form-check-label text-success" for="genrePop">Pop</label>
          </li>
          <li class="form-check">
            <input class="form-check-input" type="checkbox" value="rock" id="genreRock" checked />
            <label class="form-check-label text-success" for="genreRock">Rock</label>
          </li>
          <li class="form-check">
            <input class="form-check-input" type="checkbox" value="hiphop" id="genreHiphop" checked />
            <label class="form-check-label text-success" for="genreHiphop">Hip-Hop</label>
          </li>
          <li class="form-check">
            <input class="form-check-input" type="checkbox" value="electronic" id="genreElectronic" checked />
            <label class="form-check-label text-success" for="genreElectronic">Electronic</label>
          </li>
          <li class="form-check">
            <input class="form-check-input" type="checkbox" value="classical" id="genreClassical" checked />
            <label class="form-check-label text-success" for="genreClassical">Klassik</label>
          </li>
        </ul>
      </div>
    </div>

    <a href="index.html" class="btn btn-outline-light btn-back"><i class="bi bi-arrow-left"></i> Zur√ºck zur Startseite</a>

    <h1 class="mb-4"><i class="bi bi-graph-up-arrow icon"></i>Erweiterte Spotify Auswertung</h1>

    <div class="row g-4">
      <div class="col-md-6">
        <div class="card p-4">
          <h2 class="mb-3"><i class="bi bi-hourglass-split icon"></i>Analyse kommt bald...</h2>
          <p>Hier kannst du sp√§ter detaillierte Informationen zu deinem Musikgeschmack, deinen H√∂rzeiten, Genres, Lieblingsk√ºnstlern, Track-Verlauf und vielem mehr sehen.</p>
          <p><em>Diese Seite ist aktuell in Vorbereitung.</em></p>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-4">
          <h3><i class="bi bi-lightbulb icon"></i>Ideen f√ºr Inhalte:</h3>
          <ul>
            <li>Diagramme √ºber h√§ufig geh√∂rte Genres</li>
            <li>Verlauf deiner Lieblingsk√ºnstler im Jahr</li>
            <li>Top-Songs nach Stimmung oder Geschwindigkeit</li>
            <li>Playlist-Vorschl√§ge basierend auf deinen Daten</li>
            <li>Export-Funktion als PDF oder Bild</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Chart Bereich -->
    <div class="card p-4 mt-4">
      <h2><i class="bi bi-bar-chart icon"></i>Genre-Verteilung</h2>
      <canvas id="genreChart" height="300"></canvas>
    </div>
  </div>

  <script>
    // Beispiel-Daten je Genre (Labels und Counts)
    const genresData = {
      pop: {
        labels: ['Song A', 'Song B', 'Song C'],
        counts: [12, 19, 3]
      },
      rock: {
        labels: ['Rock Song 1', 'Rock Song 2'],
        counts: [7, 14]
      },
      hiphop: {
        labels: ['Hip-Hop 1', 'Hip-Hop 2', 'Hip-Hop 3', 'Hip-Hop 4'],
        counts: [10, 8, 15, 6]
      },
      electronic: {
        labels: ['Electronic 1', 'Electronic 2'],
        counts: [5, 11]
      },
      classical: {
        labels: ['Classical 1'],
        counts: [9]
      }
    };

    // Hilfsfunktion: Kombiniere Labels und Werte (ohne Duplikate bei Labels)
    function combineGenres(selectedGenres) {
      const combined = { labels: [], counts: [] };
      const labelMap = new Map();

      selectedGenres.forEach(genre => {
        const data = genresData[genre];
        if (!data) return;
        data.labels.forEach((label, idx) => {
          if (!labelMap.has(label)) {
            labelMap.set(label, data.counts[idx]);
          } else {
            labelMap.set(label, labelMap.get(label) + data.counts[idx]);
          }
        });
      });

      labelMap.forEach((count, label) => {
        combined.labels.push(label);
        combined.counts.push(count);
      });

      return combined;
    }

    // Chart Setup
    const ctx = document.getElementById('genreChart').getContext('2d');
    let genreChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: genresData.pop.labels,
        datasets: [{
          label: 'Anzahl Plays',
          data: genresData.pop.counts,
          backgroundColor: 'var(--spotify-green)'
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        },
        plugins: {
          legend: { labels: { color: 'var(--spotify-green)' } }
        }
      }
    });

    // Checkbox-Eventlistener f√ºr Multiselect Genres
    const checkboxes = document.querySelectorAll('.dropdown-menu input[type=checkbox]');
    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        const selectedGenres = Array.from(checkboxes)
          .filter(chk => chk.checked)
          .map(chk => chk.value);

        if (selectedGenres.length === 0) {
          // Nichts ausgew√§hlt => Chart leeren
          genreChart.data.labels = [];
          genreChart.data.datasets[0].data = [];
          genreChart.update();
          return;
        }

        const combined = combineGenres(selectedGenres);
        genreChart.data.labels = combined.labels;
        genreChart.data.datasets[0].data = combined.counts;
        genreChart.update();
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
